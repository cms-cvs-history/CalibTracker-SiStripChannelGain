process CALIB =  {

source = PoolSource 
{ 
      untracked vstring fileNames = {
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_00.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_01.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_02.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_03.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_04.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_05.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_06.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_07.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_08.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_09.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_10.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_11.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_12.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_13.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_14.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_15.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_16.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_17.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_18.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_19.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_20.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_21.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_22.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_23.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_24.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_25.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_26.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_27.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_28.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_29.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_30.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_31.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_32.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_33.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_34.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_35.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_36.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_37.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_38.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_39.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_40.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_41.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_42.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_43.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_44.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_45.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_46.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_47.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_48.root",
        "file:/storage/data/cms/users/quertenmont/MinBias/MinBias_175_SIM-DIGI-RECO_10K_49.root"
      }
}
#untracked PSet maxEvents = {untracked int32 input = 10000} #Max = ~50000
untracked PSet maxEvents = {untracked int32 input = 200000} #Max = ~50000


include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

include "CalibTracker/Configuration/data/SiStrip_FakeLorentzAngle.cff"
include "RecoTracker/TrackProducer/data/RefitterWithMaterial.cff"
replace TrackRefitter.TrajectoryInEvent = true

include "RecoTracker/DeDx/data/dedxHitsFromRefitter.cfi"

module SiStripCalib = SiStripGainFromData { 
               string   AlgoMode             = "SingleJob"
#               string   AlgoMode             = "MultiJob"
#               string   AlgoMode             = "WriteOnDB"

               vstring  VInputFiles           = {"file:FARM/Rootfiles/Histos_500K0.root",
						 "file:FARM/Rootfiles/Histos_500K1.root",
                                                 "file:FARM/Rootfiles/Histos_500K2.root",
                                                 "file:FARM/Rootfiles/Histos_500K3.root",
                                                 "file:FARM/Rootfiles/Histos_500K4.root",
                                                 "file:FARM/Rootfiles/Histos_500K5.root"
                                                 }

               string   OutputHistos         = "Histos_500KFull.root"
               string   OutputGains          = "Histos_500KFull_Gains.txt"

                string   TrajToTrackProducer = "TrackRefitter"
                string   TrajToTrackLabel    = ""

      untracked double   minTrackMomentum    = 1
      untracked uint32   minNrEntries        = 100
      untracked double   maxChi2OverNDF      = 9999999
      untracked double   maxMPVError         = 1000000
      untracked uint32   maxNrStrips         = 6

        bool SinceAppendMode      = true
        string IOVMode            = "Job"
        string Record             = "SiStripApvGainRcd"
        bool doStoreOnDB          = false
}

service = PoolDBOutputService{
   string connect = "sqlite_file:Gain_MinBias.db"
   string timetype = "runnumber"    
  #string timetype = "timestamp"    

  untracked string BlobStreamerName="TBufferBlobStreamingService"
  PSet DBParameters = {
     untracked string authenticationPath="/afs/cern.ch/cms/DB/conddb"
     untracked int32 messageLevel=2
  }

  VPSet toPut={ { string record = "SiStripApvGainRcd"   string tag ="Gain_MinBias"} }    
}

path p = {TrackRefitter, SiStripCalib} 


}
